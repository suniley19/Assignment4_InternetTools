<!DOCTYPE html>
<html>
<head>
    <title>Image Demo</title>
</head>
<body style="font-family: Arial; padding: 30px;">
<h2>Search & Upload Images</h2>

<input id="inputBox" placeholder="Type something like 'tom'" style="width: 300px; padding: 8px;">
<button onclick="searchImage()" style="padding: 8px;">Show Image</button>

<br><br>

<input type="file" style="display: block;" id="file">
<input type="text" id="filename">
<button onclick="uploadImage()" style="padding: 2px;">Upload</button>

<br><br>
<img id="imgBox" width="300" style="border: 1px solid #ccc;">


<script>
function searchImage() {
    const text = document.getElementById("inputBox").value;
    fetch(`/api/getImage?name=${encodeURIComponent(text)}`)
        .then(res => res.json())
        .then(blob => {
            const url = blob.url;
            console.log(url);
            document.getElementById("imgBox").src = url;
        })
        .catch(console.error);
}

async function uploadImage() {
    const fileInput = document.getElementById("file");
    if (!fileInput.files.length) return alert("Select a file first!");

    const fileName = document.getElementById('filename');
    if (!fileName.value) return alert("Name is mandatory");

    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append("image", file);

    console.log(file);
    console.log(formData);

    console.log(fileName);

    await fetch(`/api/upload?name=${fileName.value}`, { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
        })
        .catch(console.error);
}
</script>
</body>
</html>
